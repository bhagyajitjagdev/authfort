---
title: Database Setup
description: PostgreSQL, SQLite, and MySQL configuration.
sidebar:
  order: 9
---

import CodeBlock from '../../../components/CodeBlock.astro';

export const postgresExample = `auth = AuthFort(
    database_url="postgresql+asyncpg://user:pass@localhost:5432/mydb",
)`;

export const sqliteExample = `auth = AuthFort(
    database_url="sqlite+aiosqlite:///auth.db",
)`;

export const mysqlExample = `auth = AuthFort(
    database_url="mysql+aiomysql://user:pass@localhost:3306/mydb",
)`;

export const migrateCliExample = `authfort migrate --database-url "postgresql+asyncpg://user:pass@localhost:5432/mydb"`;

export const migrateCodeExample = `# Alternative: run migrations programmatically (e.g. in tests)
await auth.migrate()`;

export const alembicFiltersExample = `from authfort import alembic_filters, register_foreign_tables
from sqlalchemy.orm import DeclarativeBase

class Base(DeclarativeBase):
    pass

# Register AuthFort table stubs so your models can FK to authfort_users
register_foreign_tables(Base.metadata)

target_metadata = Base.metadata

def run_migrations_online():
    # ...
    context.configure(
        connection=connection,
        target_metadata=target_metadata,
        **alembic_filters(),  # Skip authfort_* tables
    )`;

export const separateDb = `# Your app
app_engine = create_async_engine("postgresql+asyncpg://user:pass@localhost/myapp")

# AuthFort — separate database
auth = AuthFort(
    database_url="postgresql+asyncpg://user:pass@localhost/auth_db",
)`;

AuthFort uses SQLAlchemy and supports any SQL database with an async driver.

## Connection Strings

### PostgreSQL

<CodeBlock code={postgresExample} />

Requires: `pip install authfort` (asyncpg is included).

### SQLite

<CodeBlock code={sqliteExample} />

Requires: `pip install authfort[sqlite]`

SQLite is great for development and small deployments. The database file is created automatically.

### MySQL

<CodeBlock code={mysqlExample} />

Requires: `pip install authfort[mysql]`

## Migrations

AuthFort includes bundled Alembic migrations. Run them via the CLI before starting your app:

<CodeBlock title="Terminal" lang="bash" code={migrateCliExample} />

The command is idempotent — it only runs pending migrations. Run it once on setup and again after upgrading AuthFort.

<CodeBlock code={migrateCodeExample} />

All AuthFort tables are prefixed with `authfort_` to avoid conflicts with your application's tables:

- `authfort_users`
- `authfort_accounts`
- `authfort_refresh_tokens`
- `authfort_user_roles`
- `authfort_signing_keys`
- `authfort_verification_tokens`
- `authfort_alembic_version`

## Sharing a Database

If your application uses the same database, AuthFort's tables coexist with yours. Two helpers make this seamless:

- **`register_foreign_tables(metadata)`** — registers stub tables so your models can `ForeignKey("authfort_users.id")`
- **`alembic_filters()`** — prevents Alembic from generating migrations for AuthFort's tables

<CodeBlock title="your_app/alembic/env.py" code={alembicFiltersExample} />

`alembic_filters()` returns both `include_name` and `include_object` filters, so Alembic won't try to create, modify, or drop any `authfort_*` tables.

## Separate Database

For production, you may want AuthFort on its own database. Just use a different connection string:

<CodeBlock code={separateDb} />

## Disposing the Engine

Call `auth.dispose()` when your application exits to clean up database connections.
