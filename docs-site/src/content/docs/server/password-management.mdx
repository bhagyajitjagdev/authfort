---
title: Password Management
description: Password reset and change password flows.
sidebar:
  order: 6
---

import { Steps } from '@astrojs/starlight/components';
import CodeBlock from '../../../components/CodeBlock.astro';

export const createToken = `token = await auth.create_password_reset_token("user@example.com")`;

export const deliverToken = `token = await auth.create_password_reset_token(email)
if token:
    await send_email(
        to=email,
        subject="Reset your password",
        body=f"https://myapp.com/reset?token={token}",
    )
# Always return success to prevent enumeration`;

export const resetPassword = `success = await auth.reset_password(token, new_password)
# True if reset, False if invalid/expired token`;

export const changePassword = `await auth.change_password(user_id, old_password, new_password)
# Raises AuthError if old password is wrong`;


AuthFort provides password reset (forgot password) and change password (authenticated) flows. Both are programmatic — you control how to deliver reset tokens (email, SMS, etc.).

## Password Reset

The password reset flow has three steps:

<Steps>

1. **Generate a reset token**

   <CodeBlock code={createToken} />

   Returns a random token string, or `None` if the email doesn't exist or belongs to an OAuth-only account. The `None` return prevents user enumeration — your API should return the same response regardless.

2. **Deliver the token**

   You handle delivery. AuthFort doesn't send emails.

   <CodeBlock code={deliverToken} />

3. **Reset the password**

   <CodeBlock code={resetPassword} />

</Steps>

Reset tokens are single-use and expire after `password_reset_ttl` seconds (default: 1 hour). After a successful reset, the user's `token_version` is bumped, invalidating all existing tokens, and all refresh tokens are revoked.

## Change Password

For authenticated users who know their current password:

<CodeBlock code={changePassword} />

This verifies the old password, hashes the new one, bumps the token version, and revokes all refresh tokens.

## Events

Emits `password_reset_requested`, `password_reset`, and `password_changed` events. See [Events & Hooks](/authfort/server/events/) for all events and their payloads.
